<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles/home.ar.css">
    <link rel="stylesheet" href="./styles/home.button.css">
    <link rel="stylesheet" href="./styles/home.general.css">
    <link rel="stylesheet" href="./styles/home.map.css">
    <link rel="stylesheet" href="./styles/home.help-menu.css">
    <title>ARbiter</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@1.0.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  </head>


  <style>
    a-scene {
  position: absolute !important;
    } 
  </style>

  <body>


    <a-scene
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">

      <!-- object 1 entrance cube -->
      <a-marker type="pattern" url="./tags/patt/pattern-tag25h9-5.patt" id="marker1">
        <a-box position="0 1 0" rotation="0 0 0" width="0.5" height="0.5" depth="0.5" id="rotating-box">

          <!-- right positions-->
          <a-plane position="-1 0 0" width="2" height="2" src="#entrance3" rotation="0 90 0" material="side: double;" class="clickable"></a-plane> <!-- needed-->
          <a-plane position="1 0 0" width="2" height="2" src="#entrance4" rotation="0 -90 0" material="side: double;" class="clickable"></a-plane> <!-- needed-->
          <a-plane position="0 1 0" width="2" height="2" src="#entrance5" rotation="-90 0 0" material="side: double;" class="clickable"></a-plane> <!-- needed-->

          <!-- plain sides-->
          <a-plane position="0 0 1" width="2" height="2" rotation="0 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
          <a-plane position="0 0 -1" width="2" height="2" rotation="0 180 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
          <a-plane position="0 -1 0" width="2" height="2" rotation="90 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
        </a-box>
    
        <a-animation
          attribute="rotation"
          to="360 360 360"
          dur="10000"
          repeat="indefinite"
          id="box-rotation">
        </a-animation>
    
      </a-marker>


      <!-- object 2 student support -->
      <a-marker type="pattern" url="./tags/patt/pattern-tag25h9-6.patt" id="marker1">
        <a-box position="0 1 0" rotation="0 0 0" width="0.5" height="0.5" depth="0.5" id="rotating-box">
<a-plane position="-1 0 0" width="2" height="2" src="#stud3" rotation="0 90 0" material="side: double;" class="clickable"></a-plane>
<a-plane position="1 0 0" width="2" height="2" src="#stud4" rotation="0 -90 0" material="side: double;" class="clickable"></a-plane>
<a-plane position="0 1 0" width="2" height="2" src="#stud5" rotation="-90 0 0" material="side: double;" class="clickable"></a-plane>

<!-- plain sides-->
<a-plane position="0 0 1" width="2" height="2" rotation="0 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
<a-plane position="0 0 -1" width="2" height="2" rotation="0 180 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
<a-plane position="0 -1 0" width="2" height="2" rotation="90 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
        </a-box>
    
        <a-animation
          attribute="rotation"
          to="360 360 360"
          dur="10000"
          repeat="indefinite"
          id="box-rotation">
        </a-animation>
    
      </a-marker>

      <!-- object 3 library -->
      <a-marker type="pattern" url="./tags/patt/pattern-tag25h9-3.patt" id="marker1">
        <a-box position="0 1 0" rotation="0 0 0" width="0.5" height="0.5" depth="0.5" id="rotating-box">
<a-plane position="-1 0 0" width="2" height="2" src="#lib3" rotation="0 90 0" material="side: double;" class="clickable"></a-plane>
<a-plane position="1 0 0" width="2" height="2" src="#lib4" rotation="0 90 0" material="side: double;" class="clickable"></a-plane>
<a-plane position="0 1 0" width="2" height="2" src="#lib5" rotation="-90 0 0" material="side: double;" class="clickable"></a-plane>

<!-- plain sides-->
<a-plane position="0 0 1" width="2" height="2" rotation="0 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
<a-plane position="0 0 -1" width="2" height="2" rotation="0 180 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
<a-plane position="0 -1 0" width="2" height="2" rotation="90 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
        </a-box>
    
        <a-animation
          attribute="rotation"
          to="360 360 360"
          dur="10000"
          repeat="indefinite"
          id="box-rotation">
        </a-animation>
    
      </a-marker>

      <!-- object 4 cafe -->
      <a-marker type="pattern" url="./tags/patt/pattern-tag25h9-10.patt" id="marker1">
        <a-box position="0 1 0" rotation="0 0 0" width="0.5" height="0.5" depth="0.5" id="rotating-box">
<a-plane position="-1 0 0" width="2" height="2" src="#cafe3" rotation="0 90 0" material="side: double;" class="clickable"></a-plane>
<a-plane position="1 0 0" width="2" height="2" src="#cafe4" rotation="0 -90 0" material="side: double;" class="clickable"></a-plane>
<a-plane position="0 1 0" width="2" height="2" src="#cafe5" rotation="-90 0 0" material="side: double;" class="clickable"></a-plane>

<!-- plain sides-->
<a-plane position="0 0 1" width="2" height="2" rotation="0 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
<a-plane position="0 0 -1" width="2" height="2" rotation="0 180 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
<a-plane position="0 -1 0" width="2" height="2" rotation="90 0 0" material="side: double; color: #5B56B7;" class="clickable"></a-plane>
        </a-box>
    
        <a-animation
          attribute="rotation"
          to="360 360 360"
          dur="10000"
          repeat="indefinite"
          id="box-rotation">
        </a-animation>
    
      </a-marker>
    
      <a-entity camera></a-entity>

 
      <!-- Карта -->
      <a-marker type="pattern" url="./tags/patt/pattern-tag25h9-4.patt" id="marker-map">
        <a-entity id="platform" position="0 0 0">
          <a-plane position="0 1 0" width="2" height="1" rotation="-90 0 0" src="#mapImage" material="shader: flat; opacity: 0.9;"></a-plane>
          
          <!-- Кнопка "Lower Floor" -->
          <a-box position="-0.6 1.6 0" width="0.3" height="0.15" depth="0.1" color="#ff6347" class="button" onclick="switchToLowerFloor()"></a-box>
          <a-text value="Lower Floor" position="-0.6 1.75 0" color="#ffffff" align="center" scale="0.5 0.5 0.5"></a-text>
          
          <!-- Кнопка "Upper Floor" -->
          <a-box position="0.6 1.6 0" width="0.3" height="0.15" depth="0.1" color="#4682b4" class="button" onclick="switchToUpperFloor()"></a-box>
          <a-text value="Upper Floor" position="0.6 1.75 0" color="#ffffff" align="center" scale="0.5 0.5 0.5"></a-text>
        </a-entity>
      </a-marker>
      
      <a-assets>
        <!-- map-->
        <img id="mapImage" src="../static/first_floor.png">
        <!--entrance-->
        <img id="entrance3" src="./tags/pos_photos/entrance/entrance_desc.png">
        <img id="entrance4" src="./tags/pos_photos/entrance/entrance_direct.png">
        <img id="entrance5" src="./tags/pos_photos/entrance/entrance.png">
        <!--stud support-->
        <img id="stud3" src="./tags/pos_photos/student_support/stud_desc.png">
        <img id="stud4" src="./tags/pos_photos/student_support/stud_dir.png">
        <img id="stud5" src="./tags/pos_photos/student_support/student_support.png">
        <!--library-->
        <img id="lib3" src="./tags/pos_photos/library/lib_desc.png">
        <img id="lib4" src="./tags/pos_photos/library/lib_dir.png">
        <img id="lib5" src="./tags/pos_photos/library/library.png">
        <!--cafe-->
        <img id="cafe3" src="./tags/pos_photos/cafe/cafe_description.png">
        <img id="cafe4" src="./tags/pos_photos/cafe/cafe_directions.png">
        <img id="cafe5" src="./tags/pos_photos/cafe/cafe.png">
      </a-assets>
    
      <script>
        // map
    const platform = document.querySelector('#platform');
    const lowerFloor = platform.querySelector('a-ring:nth-child(1)');
    const upperFloor = platform.querySelector('a-ring:nth-child(2)');
    
    function switchToLowerFloor() {
      upperFloor.setAttribute('visible', 'false');
      lowerFloor.setAttribute('visible', 'true');
    }
    
    function switchToUpperFloor() {
      lowerFloor.setAttribute('visible', 'false');
      upperFloor.setAttribute('visible', 'true');
    }
    switchToLowerFloor();

        // cube
        const rotatingBox = document.querySelector('#rotating-box');
        const animation = document.querySelector('#box-rotation');
        
        let rotationY = 0;
    
        function stopRotation(event) {
  animation.parentNode.removeChild(animation); 
  const clickedFace = event.target;
  const rotation = clickedFace.getAttribute('rotation');
  rotatingBox.setAttribute('rotation', `0 ${rotation.y} 0`);
  rotationY = rotation.y;
        }
        const clickableFaces = document.querySelectorAll('.clickable');
clickableFaces.forEach(face => {
  face.addEventListener('click', stopRotation);
});
        function handleSwipe(event) {
          const swipeDirection = event.detail.direction;
    
          if (swipeDirection === 'left') {
            rotationY += 90;
          } else if (swipeDirection === 'right') {
            rotationY -= 90; 
          }
          rotatingBox.setAttribute('rotation', { x: 0, y: rotationY, z: 0 });
        }
        AFRAME.registerComponent('swipe-listener', {
          init: function() {
            this.el.addEventListener('swipe', handleSwipe);
          }
        });
        const marker = document.querySelector('#marker1');
        marker.setAttribute('swipe-listener', '');
      </script>
    </a-scene>
  </body>
</html>